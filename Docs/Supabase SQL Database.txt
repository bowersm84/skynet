-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.assembly_bom (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  assembly_id uuid NOT NULL,
  component_id uuid NOT NULL,
  quantity integer NOT NULL DEFAULT 1,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT assembly_bom_pkey PRIMARY KEY (id),
  CONSTRAINT assembly_bom_assembly_id_fkey FOREIGN KEY (assembly_id) REFERENCES public.parts(id),
  CONSTRAINT assembly_bom_component_id_fkey FOREIGN KEY (component_id) REFERENCES public.parts(id)
);
CREATE TABLE public.assembly_component_checkins (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  work_order_assembly_id uuid NOT NULL,
  job_id uuid NOT NULL,
  checked_in_at timestamp with time zone DEFAULT now(),
  checked_in_by uuid,
  quantity_received integer NOT NULL DEFAULT 1,
  condition_notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT assembly_component_checkins_pkey PRIMARY KEY (id),
  CONSTRAINT assembly_component_checkins_work_order_assembly_id_fkey FOREIGN KEY (work_order_assembly_id) REFERENCES public.work_order_assemblies(id),
  CONSTRAINT assembly_component_checkins_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT assembly_component_checkins_checked_in_by_fkey FOREIGN KEY (checked_in_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.bar_sizes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  size text NOT NULL UNIQUE,
  size_decimal numeric,
  shape text DEFAULT 'round'::text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bar_sizes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.document_types (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text,
  category character varying DEFAULT 'general'::character varying,
  file_types_allowed ARRAY DEFAULT ARRAY['pdf'::text, 'xlsx'::text, 'xls'::text, 'jpg'::text, 'png'::text],
  requires_approval boolean DEFAULT true,
  is_digital_form boolean DEFAULT false,
  sort_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT document_types_pkey PRIMARY KEY (id)
);
CREATE TABLE public.job_document_snapshots (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  job_id uuid NOT NULL,
  part_document_id uuid NOT NULL,
  document_type_id uuid NOT NULL,
  snapshot_file_url text NOT NULL,
  snapshot_version character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT job_document_snapshots_pkey PRIMARY KEY (id),
  CONSTRAINT job_document_snapshots_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT job_document_snapshots_part_document_id_fkey FOREIGN KEY (part_document_id) REFERENCES public.part_documents(id),
  CONSTRAINT job_document_snapshots_document_type_id_fkey FOREIGN KEY (document_type_id) REFERENCES public.document_types(id)
);
CREATE TABLE public.job_documents (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  job_id uuid NOT NULL,
  document_type_id uuid NOT NULL,
  file_name character varying,
  file_url text,
  file_size integer,
  mime_type character varying,
  form_data jsonb,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying]::text[])),
  uploaded_by uuid,
  approved_by uuid,
  approved_at timestamp with time zone,
  rejection_reason text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT job_documents_pkey PRIMARY KEY (id),
  CONSTRAINT job_documents_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT job_documents_document_type_id_fkey FOREIGN KEY (document_type_id) REFERENCES public.document_types(id),
  CONSTRAINT job_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.profiles(id),
  CONSTRAINT job_documents_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.job_materials (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  job_id uuid NOT NULL,
  material_type text NOT NULL,
  bar_size text NOT NULL,
  lot_number text,
  bars_loaded integer NOT NULL DEFAULT 0,
  bars_remaining integer,
  loaded_by uuid,
  loaded_at timestamp with time zone DEFAULT now(),
  completed_by uuid,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  bar_length numeric,
  CONSTRAINT job_materials_pkey PRIMARY KEY (id),
  CONSTRAINT job_materials_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT job_materials_loaded_by_fkey FOREIGN KEY (loaded_by) REFERENCES public.profiles(id),
  CONSTRAINT job_materials_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.job_routing_steps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  job_id uuid NOT NULL,
  step_order integer NOT NULL,
  step_name text NOT NULL,
  step_type text DEFAULT 'internal'::text,
  station text,
  removal_requested_by uuid,
  removal_approved_by uuid,
  removal_approved_at timestamp with time zone,
  lot_number text,
  quantity integer,
  completed_at timestamp with time zone,
  completed_by uuid,
  operator_initials text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'complete'::text, 'skipped'::text, 'removal_pending'::text, 'removed'::text])),
  removal_requested_at timestamp with time zone,
  removal_reason text,
  is_added_step boolean DEFAULT false,
  added_by uuid,
  added_at timestamp with time zone,
  started_at timestamp with time zone,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT job_routing_steps_pkey PRIMARY KEY (id),
  CONSTRAINT job_routing_steps_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT job_routing_steps_removal_requested_by_fkey FOREIGN KEY (removal_requested_by) REFERENCES public.profiles(id),
  CONSTRAINT job_routing_steps_removal_approved_by_fkey FOREIGN KEY (removal_approved_by) REFERENCES public.profiles(id),
  CONSTRAINT job_routing_steps_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES public.profiles(id),
  CONSTRAINT job_routing_steps_added_by_fkey FOREIGN KEY (added_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.job_tools (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  job_id uuid NOT NULL,
  tool_instance_id uuid,
  tool_name character varying NOT NULL,
  tool_type character varying,
  serial_number character varying,
  notes text,
  added_by uuid,
  added_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT job_tools_pkey PRIMARY KEY (id),
  CONSTRAINT job_tools_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT job_tools_tool_instance_id_fkey FOREIGN KEY (tool_instance_id) REFERENCES public.tool_instances(id),
  CONSTRAINT job_tools_added_by_fkey FOREIGN KEY (added_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.jobs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  work_order_id uuid NOT NULL,
  part_id uuid,
  job_number character varying NOT NULL,
  quantity integer NOT NULL DEFAULT 1,
  priority character varying DEFAULT 'normal'::character varying CHECK (priority::text = ANY (ARRAY['critical'::character varying, 'high'::character varying, 'normal'::character varying, 'low'::character varying]::text[])),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending_compliance'::character varying, 'ready'::character varying, 'assigned'::character varying, 'in_setup'::character varying, 'in_progress'::character varying, 'manufacturing_complete'::character varying, 'pending_passivation'::character varying, 'in_passivation'::character varying, 'pending_post_manufacturing'::character varying, 'ready_for_assembly'::character varying, 'in_assembly'::character varying, 'pending_tco'::character varying, 'complete'::character varying, 'incomplete'::character varying, 'cancelled'::character varying]::text[])),
  assigned_machine_id uuid,
  assigned_user_id uuid,
  checked_in_at timestamp with time zone,
  checked_out_at timestamp with time zone,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  component_id uuid,
  work_order_assembly_id uuid,
  scheduled_start timestamp with time zone,
  scheduled_end timestamp with time zone,
  estimated_minutes integer CHECK (estimated_minutes IS NULL OR estimated_minutes > 0),
  actual_start timestamp with time zone,
  actual_end timestamp with time zone,
  requires_attendance boolean DEFAULT false,
  scheduled_by uuid,
  scheduled_at timestamp with time zone,
  setup_start timestamp with time zone,
  production_start timestamp with time zone,
  good_pieces integer DEFAULT 0,
  bad_pieces integer DEFAULT 0,
  time_per_unit numeric,
  tooling_confirmed boolean DEFAULT false,
  tooling_override boolean DEFAULT false,
  tooling_override_by uuid,
  tooling_override_at timestamp with time zone,
  incomplete_reason text,
  incomplete_at timestamp with time zone,
  incomplete_by uuid,
  material_confirmed boolean DEFAULT false,
  material_confirmed_at timestamp with time zone,
  material_confirmed_by uuid,
  material_override boolean DEFAULT false,
  material_override_by uuid,
  material_override_at timestamp with time zone,
  is_maintenance boolean DEFAULT false,
  maintenance_description text,
  passivation_start timestamp with time zone,
  passivation_end timestamp with time zone,
  passivation_operator_id uuid,
  passivation_notes text,
  CONSTRAINT jobs_pkey PRIMARY KEY (id),
  CONSTRAINT jobs_work_order_id_fkey FOREIGN KEY (work_order_id) REFERENCES public.work_orders(id),
  CONSTRAINT jobs_part_id_fkey FOREIGN KEY (part_id) REFERENCES public.parts(id),
  CONSTRAINT jobs_assigned_machine_id_fkey FOREIGN KEY (assigned_machine_id) REFERENCES public.machines(id),
  CONSTRAINT jobs_assigned_user_id_fkey FOREIGN KEY (assigned_user_id) REFERENCES public.profiles(id),
  CONSTRAINT jobs_component_id_fkey FOREIGN KEY (component_id) REFERENCES public.parts(id),
  CONSTRAINT jobs_work_order_assembly_id_fkey FOREIGN KEY (work_order_assembly_id) REFERENCES public.work_order_assemblies(id),
  CONSTRAINT jobs_scheduled_by_fkey FOREIGN KEY (scheduled_by) REFERENCES public.profiles(id),
  CONSTRAINT jobs_tooling_override_by_fkey FOREIGN KEY (tooling_override_by) REFERENCES public.profiles(id),
  CONSTRAINT jobs_incomplete_by_fkey FOREIGN KEY (incomplete_by) REFERENCES public.profiles(id),
  CONSTRAINT jobs_material_confirmed_by_fkey FOREIGN KEY (material_confirmed_by) REFERENCES public.profiles(id),
  CONSTRAINT jobs_material_override_by_fkey FOREIGN KEY (material_override_by) REFERENCES public.profiles(id),
  CONSTRAINT jobs_passivation_operator_id_fkey FOREIGN KEY (passivation_operator_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.locations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  code character varying NOT NULL UNIQUE,
  address text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT locations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.machine_downtime_logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  machine_id uuid NOT NULL,
  job_id uuid,
  start_time timestamp with time zone NOT NULL,
  end_time timestamp with time zone,
  reason character varying NOT NULL,
  notes text,
  sent_to_scheduling boolean DEFAULT false,
  sent_to_scheduling_at timestamp with time zone,
  logged_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT machine_downtime_logs_pkey PRIMARY KEY (id),
  CONSTRAINT machine_downtime_logs_machine_id_fkey FOREIGN KEY (machine_id) REFERENCES public.machines(id),
  CONSTRAINT machine_downtime_logs_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.jobs(id),
  CONSTRAINT machine_downtime_logs_logged_by_fkey FOREIGN KEY (logged_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.machines (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  location_id uuid NOT NULL,
  name character varying NOT NULL,
  code character varying NOT NULL,
  machine_type character varying,
  status character varying DEFAULT 'available'::character varying CHECK (status::text = ANY (ARRAY['available'::character varying::text, 'in_use'::character varying::text, 'maintenance'::character varying::text, 'offline'::character varying::text, 'down'::character varying::text])),
  display_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  status_reason text,
  status_updated_at timestamp with time zone,
  status_updated_by uuid,
  CONSTRAINT machines_pkey PRIMARY KEY (id),
  CONSTRAINT machines_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.locations(id),
  CONSTRAINT machines_status_updated_by_fkey FOREIGN KEY (status_updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.material_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  short_code text,
  category text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT material_types_pkey PRIMARY KEY (id)
);
CREATE TABLE public.part_document_requirements (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  part_id uuid NOT NULL,
  document_type_id uuid NOT NULL,
  is_required boolean DEFAULT true,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  required_at character varying DEFAULT 'compliance_review'::character varying CHECK (required_at::text = ANY (ARRAY['compliance_review'::character varying, 'manufacturing_complete'::character varying, 'tco'::character varying]::text[])),
  CONSTRAINT part_document_requirements_pkey PRIMARY KEY (id),
  CONSTRAINT part_document_requirements_part_id_fkey FOREIGN KEY (part_id) REFERENCES public.parts(id),
  CONSTRAINT part_document_requirements_document_type_id_fkey FOREIGN KEY (document_type_id) REFERENCES public.document_types(id)
);
CREATE TABLE public.part_documents (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  part_id uuid NOT NULL,
  document_type_id uuid NOT NULL,
  file_name character varying NOT NULL,
  file_url text NOT NULL,
  file_size integer,
  mime_type character varying,
  version character varying DEFAULT 'A'::character varying,
  revision_notes text,
  uploaded_by uuid,
  is_current boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT part_documents_pkey PRIMARY KEY (id),
  CONSTRAINT part_documents_part_id_fkey FOREIGN KEY (part_id) REFERENCES public.parts(id),
  CONSTRAINT part_documents_document_type_id_fkey FOREIGN KEY (document_type_id) REFERENCES public.document_types(id),
  CONSTRAINT part_documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.part_machine_durations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  part_id uuid NOT NULL,
  machine_id uuid NOT NULL,
  estimated_minutes integer NOT NULL CHECK (estimated_minutes > 0),
  is_preferred boolean DEFAULT false,
  preference_order integer DEFAULT 0,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  base_quantity integer,
  CONSTRAINT part_machine_durations_pkey PRIMARY KEY (id),
  CONSTRAINT part_machine_durations_part_id_fkey FOREIGN KEY (part_id) REFERENCES public.parts(id),
  CONSTRAINT part_machine_durations_machine_id_fkey FOREIGN KEY (machine_id) REFERENCES public.machines(id),
  CONSTRAINT part_machine_durations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.part_routing_steps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  part_id uuid NOT NULL,
  step_order integer NOT NULL,
  step_name text NOT NULL,
  step_type text DEFAULT 'internal'::text,
  default_station text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT part_routing_steps_pkey PRIMARY KEY (id),
  CONSTRAINT part_routing_steps_part_id_fkey FOREIGN KEY (part_id) REFERENCES public.parts(id)
);
CREATE TABLE public.parts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  part_number character varying NOT NULL UNIQUE,
  description text,
  customer character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  part_type character varying DEFAULT 'manufactured'::character varying CHECK (part_type::text = ANY (ARRAY['assembly'::character varying, 'finished_good'::character varying, 'manufactured'::character varying, 'purchased'::character varying]::text[])),
  specification character varying,
  unit_cost numeric DEFAULT 0,
  requires_passivation boolean DEFAULT false,
  material_type_id uuid,
  drawing_revision character varying,
  CONSTRAINT parts_pkey PRIMARY KEY (id),
  CONSTRAINT parts_material_type_id_fkey FOREIGN KEY (material_type_id) REFERENCES public.material_types(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  email character varying NOT NULL,
  full_name character varying,
  role character varying NOT NULL DEFAULT 'machinist'::character varying CHECK (role::text = ANY (ARRAY['admin'::character varying, 'compliance'::character varying, 'machinist'::character varying, 'assembly'::character varying, 'display'::character varying, 'scheduler'::character varying, 'customer_service'::character varying]::text[])),
  home_location_id uuid,
  can_float boolean DEFAULT false,
  pin_code character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  can_approve_compliance boolean DEFAULT false,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id),
  CONSTRAINT profiles_home_location_id_fkey FOREIGN KEY (home_location_id) REFERENCES public.locations(id)
);
CREATE TABLE public.routing_template_steps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  template_id uuid NOT NULL,
  step_order integer NOT NULL,
  step_name text NOT NULL,
  step_type text DEFAULT 'internal'::text,
  default_station text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT routing_template_steps_pkey PRIMARY KEY (id),
  CONSTRAINT routing_template_steps_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.routing_templates(id)
);
CREATE TABLE public.routing_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  material_category text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  description text,
  CONSTRAINT routing_templates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tool_instances (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  tool_id uuid NOT NULL,
  serial_number character varying NOT NULL,
  status character varying DEFAULT 'good'::character varying CHECK (status::text = ANY (ARRAY['good'::character varying, 'bad'::character varying, 'discarded'::character varying]::text[])),
  notes text,
  logged_by uuid,
  logged_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tool_instances_pkey PRIMARY KEY (id),
  CONSTRAINT tool_instances_tool_id_fkey FOREIGN KEY (tool_id) REFERENCES public.tools(id),
  CONSTRAINT tool_instances_logged_by_fkey FOREIGN KEY (logged_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.tools (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL UNIQUE,
  tool_type character varying NOT NULL,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tools_pkey PRIMARY KEY (id)
);
CREATE TABLE public.work_order_assemblies (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  work_order_id uuid NOT NULL,
  assembly_id uuid NOT NULL,
  quantity integer NOT NULL DEFAULT 1,
  created_at timestamp with time zone DEFAULT now(),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'in_progress'::character varying, 'paused'::character varying, 'complete'::character varying]::text[])),
  assembly_started_at timestamp with time zone,
  assembly_started_by uuid,
  assembly_completed_at timestamp with time zone,
  assembly_completed_by uuid,
  assembly_notes text,
  station_number integer,
  assembler_number integer,
  good_quantity integer,
  bad_quantity integer,
  CONSTRAINT work_order_assemblies_pkey PRIMARY KEY (id),
  CONSTRAINT work_order_assemblies_work_order_id_fkey FOREIGN KEY (work_order_id) REFERENCES public.work_orders(id),
  CONSTRAINT work_order_assemblies_assembly_id_fkey FOREIGN KEY (assembly_id) REFERENCES public.parts(id),
  CONSTRAINT work_order_assemblies_assembly_started_by_fkey FOREIGN KEY (assembly_started_by) REFERENCES public.profiles(id),
  CONSTRAINT work_order_assemblies_assembly_completed_by_fkey FOREIGN KEY (assembly_completed_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.work_orders (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  wo_number character varying NOT NULL UNIQUE,
  customer character varying,
  po_number character varying,
  priority character varying DEFAULT 'normal'::character varying CHECK (priority::text = ANY (ARRAY['critical'::character varying, 'high'::character varying, 'normal'::character varying, 'low'::character varying]::text[])),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'in_progress'::character varying, 'ready_for_assembly'::character varying, 'in_assembly'::character varying, 'complete'::character varying, 'shipped'::character varying, 'on_hold'::character varying, 'closed'::character varying]::text[])),
  due_date date,
  notes text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  order_type character varying DEFAULT 'make_to_order'::character varying CHECK (order_type::text = ANY (ARRAY['make_to_order'::character varying, 'make_to_stock'::character varying, 'maintenance'::character varying]::text[])),
  closed_at timestamp with time zone,
  closed_by uuid,
  tco_notes text,
  maintenance_type text,
  machine_id uuid,
  stock_quantity integer,
  CONSTRAINT work_orders_pkey PRIMARY KEY (id),
  CONSTRAINT work_orders_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id),
  CONSTRAINT work_orders_closed_by_fkey FOREIGN KEY (closed_by) REFERENCES public.profiles(id),
  CONSTRAINT work_orders_machine_id_fkey FOREIGN KEY (machine_id) REFERENCES public.machines(id)
);